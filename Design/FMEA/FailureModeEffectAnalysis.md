# FMEA
1. *Failure mode analysis (FMA)* is a process for building resiliency into a system, by identifying possible failure points in the system. 
2. The FMA should be part of the architecture and design phases, so that you can build failure recovery into the system from the beginning.
3. Identify all *fault-points and fault-modes*. Fault-points describe the elements within an application architecture which are capable of failing, while fault-modes capture the various ways by which a fault-point may fail. To ensure an application is resilient to end-to-end failures, it is essential that all fault-points and fault-modes are understood and operationalized.
4. The idea is to eliminate all *single point of failure*. A single point of failure describes a specific fault-point which if it where to fail, would bring down the entire application. Single points of failure introduce significant risk since any failure of this component will cause an application outage.

#Understand the impact of dependencies
1. *Internal dependencies* describe components within the application scope which are required for the application to fully operate.
2. *External dependencies* capture required components outside the scope of the application, such as another application or third-party service.
3. Dependencies may be categorized as either **strong/critical or weak/non-critical** based on whether or not the application is able to continue operating in a degraded fashion in their absence.
4. Maintain SLAs and support agreements for critical dependencies. A Service Level Agreement (SLA) represents a commitment around performance and availability of the application. Understanding the SLA of individual components within the system is essential in order to define reliability targets. 
5. **Knowing the SLA of dependencies** will also provide a justification for additional spend when making the dependencies highly available and with proper support contracts.

# FMEA Worksheet
The following is an excerpt from a FMEA worksheet that is developed for the architecture that we have considered. I have taken some of the key columns from Microsoft's Resiliency Modeling Analysis White Paper and a regular FMEA process for cloud applications.

## Userflow: Website access for read and write operations

| Failure Point                   | Failure Modes                                       | Failure Short Name                                      | Failure Short Description                                                                                                                                                   | Impact/ Effect                                                                                                                              | System Response                                                                                                                                                                          | Possible Remediation                                                                                                                                                                                      |
|---------------------------------|-----------------------------------------------------|---------------------------------------------------------|-----------------------------------------------------------------------------------------------------------------------------------------------------------------------------|---------------------------------------------------------------------------------------------------------------------------------------------|------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|-----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|
|                                 |                                                     |                                                         |                                                                                                                                                                             |                                                                                                                                             |                                                                                                                                                                                          |                                                                                                                                                                                                           |
| Traffic Manager                 | Traffic Manager unavailable                         | Existence: Global DNS Load Balancer                     | Traffic Manager is unavailable within the Error possibilities                                                                                                               | Entire Customer Website becomes inaccessible                                                                                                | Monitoring System will capture the accessibility issues from the "Resource Health Events" and generate an alert                                                                          | "Deployment of a failover global load balancer soln in standby mode (e.g. Azure Front Door) Note: Manual failover between the global LBs is required"                                                     |
|                                 | Traffic Manager Endpoint Degradation                | NoResponse: Azure Application Gateway                   | "Primary Site endpoint website hosted on app-gw is not accessible Health Check endpoint is not accessible"                                                                  | Entire Customer Website becomes inaccessible                                                                                                | System attempts to failover to the secondary site                                                                                                                                        | Failover to the secondary site after the configured "N" retries and "M" failed responses                                                                                                                  |
|                                 |                                                     | Existence: Application Gateway                          | Primary Site is not accessible: Gateway is down                                                                                                                             | Entire Customer Website becomes inaccessible                                                                                                | System attempts to failover to the secondary site                                                                                                                                        | Failover to the secondary site after the configured "N" retries and "M" failed responses                                                                                                                  |
|                                 |                                                     | Degradation: Web-Server VMSS (all instances)            | "Primary Site endpoint health check failed Health check endpoint returns error response/500"                                                                                | Primary site is not accessible                                                                                                              | System attempts to failover to the secondary site                                                                                                                                        | Failover to the secondary site after the configured "N" retries and "M" failed responses                                                                                                                  |
|                                 |                                                     | Degradation: Internal Load Balancer                     | Primary Site endpoint health check failed: ILB is down                                                                                                                      | Primary site is not accessible                                                                                                              | System attempts to failover to the secondary site                                                                                                                                        | Failover to the secondary site after the configured "N" retries and "M" failed responses                                                                                                                  |
|                                 |                                                     | Degradation: SQL Server Cluster                         | Primary Site endpoint health check failed: SQL Server Availability Group (AG) is not accessible                                                                             | Primary site is not accessible                                                                                                              | System attempts to failover to the secondary site                                                                                                                                        | Failover to the secondary site after the configured "N" retries and "M" failed responses                                                                                                                  |
| Azure DNS                       | Azure DNS unavailable                               | Existence: Global DNS                                   |                                                                                                                                                                             |                                                                                                                                             |                                                                                                                                                                                          |                                                                                                                                                                                                           |
|                                 | Azure DNS Latency                                   | Latency: Global DNS                                     | Latency in resolving the endpoint address (after an endpoint is identified by Traffic Manager's routing alg)                                                                | A latency is introduced in the user's request for a resource                                                                                | NA                                                                                                                                                                                       | NA                                                                                                                                                                                                        |
| Azure App Gateway               | Application Gateway is unavailable                  | Existence: Public App-GW                                | Primary Site is not accessible: Gateway is down                                                                                                                             | Entire Customer Website becomes inaccessible                                                                                                | System attempts to failover to the secondary site                                                                                                                                        | Failover to the secondary site after the configured "N" retries and "M" failed responses                                                                                                                  |
|                                 | Application Gateway Degradation                     | Degradation: Resource Limitation observed               | Application Gateway CPU/Memory Metrics indicate that it is unable to handle the volume of traffic                                                                           | No Impact                                                                                                                                   | "App-Gw autoscales to handle the request rate Note: The scaleout limit should not have been reached already"                                                                             |                                                                                                                                                                                                           |
|                                 |                                                     | Degradation: Scale-out failure                          | Application Gateway is unable to autoscale: autoscale limit has been reached                                                                                                | User Requests can get dropped (unwanted load shedding can happen)                                                                           | System would start returning error responses                                                                                                                                             | Manual intervention to either a) increase the threshold of autoscale limit or b) analyze the request volume pattern                                                                                       |
|                                 | Application Gateway Connection Failure              | Bad Auth:  expired TLS certificate                      | TLS Handshsake failure due to expired TLS certificate of the site hosted at the app gateway                                                                                 | Users may be shown the warning of accessing a risky site                                                                                    |                                                                                                                                                                                          | The TLS handshake failure if configured for alerting, can then be acted on accordingly                                                                                                                    |
| Virtual Machine ScaleSets       | Web-Tiers VM(s) are not available                   | Existence: Scale-set instance failure                   | VMSS is functioning in reduced capacity because of the loss of one or more instances                                                                                        | No direct user impact                                                                                                                       | Requests would be balanced among the other available instances                                                                                                                           |                                                                                                                                                                                                           |
|                                 |                                                     |                                                         | VMSS is functioning in reduced capacity for prolonged periods                                                                                                               | "User experience would be affected e.g., Delayed responses"                                                                                 |                                                                                                                                                                                          | Set the appropriate lowerbound instance count of the VMSS - This would trigger the automatic creation of new instances to handle the scale count condition                                                |
|                                 | Web-Tier VMSS is not available                      | Existence: All instances of the scale-set fail          | Health probe failure (m/n attempts) (because of the unavailable condition of the backend pool instances of app gateway)                                                     | Temporary unavailable status of the site                                                                                                    | Health probes would succeed if the system spins up new instances before the "N" retries and "M" failed responses of the LB's health probe                                                | Set the conditions in the health probes of app-gw to retry sufficient no.of times & at properly spaced intervals                                                                                          |
|                                 |                                                     |                                                         | Health probe failure(m/m attempts) - autoscale failure                                                                                                                      | Entire Customer Website becomes inaccessible                                                                                                | System would failover to the secondary site                                                                                                                                              | Monitoring the instance level failure conditions (health events) and executing a suitable remediation action- TBV                                                                                         |
|                                 | Web-Tier VM(s) Degradation                          | Degradation: VMs CPU or memory utilization is high      | selected set of VMs receive high volume of traffic due to a) sticky sessions b) load-test scenario from the same host (srcIP and srcPort)                                   | Some of the customer requests might be affected: slow response, error etc.,                                                                 | "System would raise a diagnostics alert if configured e.g. alert and email if instances have CPU percentage more than 70% for more than 15 minutes"                                      | Auto-Scale the VMSS based on the resource metrics.                                                                                                                                                        |
|                                 | Web-Tier application Latency/No Response            | Latency: website                                        | Application level issues causing latency                                                                                                                                    | "Customer experience would be impacted Severity can be as high as customer leaving the site"                                                |                                                                                                                                                                                          | Possible application level changes can be made depending on the metrics gathered from application insighst                                                                                                |
| Internal Load Balancer          | Internal Load Balancer Degradation                  | Degradation: Internal Load Balancer                     | Primary Site endpoint health check failed: ILB is down                                                                                                                      | Primary site is not accessible                                                                                                              | System attempts to failover to the secondary site                                                                                                                                        | Failover to the secondary site after the configured "N" retries and "M" failed responses                                                                                                                  |
| Virtual Machines in the DB Tier | VM instances becoming unavailable                   | Existence: Unavailable VM Instances- Secondary Replicas | "VM instances become unavailable due to Network failure  m/n Secondary Replica Instances Failing"                                                                           | Some of the read operations will be delayed                                                                                                 | System will reroute the read operations to the remaining read replicas                                                                                                                   |                                                                                                                                                                                                           |
|                                 |                                                     |                                                         | "VM instances become unavailable due to Network failure  n/n Secondary Replica Instances Failing"                                                                           | DB read and write operations will be impacted as now Primary instance will handle both reads & writes                                       | System will reroute all the read operations to the primary DB instance- TBV                                                                                                              |                                                                                                                                                                                                           |
|                                 |                                                     | Existence: Unavailable VM Instances- Primary Instance   | "VM instances become unavailable due to Network failure  Primary Replica Instance Failing"                                                                                  | Intermittent delay in the write operations resulting in a slightly less consistent reads                                                    | System will promote one of the read replicas to the Primary status                                                                                                                       |                                                                                                                                                                                                           |
|                                 |                                                     | Existence: All instances are unavailable                | All VM instances go unavailable                                                                                                                                             | "Backend DB cluster would be unavailable.  a) Write operations will fail until remediated
b) Read operations might work if a cache is used" | If the WSFC is configured with instances from secondary region, then one of the secondary replicas from region#2 will be promoted to Primary role. The failover needs to be manual - TBV | Design the custom health probe to check the health of the Availability Group (AG) . This can help in failing over the application also to the secondary region and avoid any cross-region request latency |
|                                 | SQL Server VM(s) Degradation                        | Degradation: VMs CPU or memory utilization is high      | "selected set of VMs receive high volume of traffic Impact could be on the read replicas for unanticipated read traffic & on the Primary instance for higher write traffic" | Some of the customer requests might be affected: slow response, error etc.,                                                                 | "System would raise a diagnostics alert if configured
e.g. alert and email if instances have CPU percentage more than 70% for more than 15 minutes"                                      |                                                                                                                                                                                                           |
|                                 | SQL Server Database operations- Latency/No Response | Latency: Database Access (Read/Write)                   | DB level issues causing latency                                                                                                                                             | "Customer experience would be impacted. Slow read - users leaving the site
Slow write - TBD"                                                |                                                                                                                                                                                          | Possible DB level changes can be made depending on the metrics gathered from application insighst                                                                                                         |
